local apps = [
  /*
  {
    image: "griffinhtdocker/ip-server:latest",
    name: "ip-server",
    ports: [
      {
        containerPort: 80,
        name: "http"
      }
    ]
  },*/
  {
    image: "quay.io/redlib/redlib:latest",
    name: "redlib",
    ports: [
      {
        containerPort: 8080,
        name: "http"
      }
    ]
  },
  {
    image: "kennethreitz/httpbin",
    name: "httpbin",
    ports: [
      {
        containerPort: 80,
        name: "http"
      }
    ],
  },
  {
    "name": "speedtest",
    "image": "ghcr.io/librespeed/speedtest:latest",
    "env": [
      {
        "name": "MODE",
        "value": "standalone"
      }
    ],
    "ports": [
      {
        "containerPort": 80,
        "name": "http"
      }
    ],
    "resources": {
      "requests": {
        "memory": "512Mi",
        "cpu": "250m"
      }
    }
  },
  {
    "name": "searxng",
    "image": "docker.io/searxng/searxng",
    "ports": [
        {
            "containerPort": 8080,
            "name": "http"
        }
    ],
    "resources": {
      "requests": {
        "memory": "512Mi",
        "cpu": "250m"
      }
    }
  }
];

local NetworkPolicy = import "NetworkPolicy.json";
local Service = import "Service.json";
local Deployment = import "Deployment.jsonnet";

//https://devops.stackexchange.com/questions/18440/what-is-a-single-kubectl-list-object-as-mentioned-in-jsonnet-documentation
{
  apiVersion: "v1",
  kind: "List",
  items: [
    NetworkPolicy(app)
    for app in apps
  ] + [
    Service(app)
    for app in apps
  ] + [
    Deployment(app)
    for app in apps
  ]
}

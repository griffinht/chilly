services:
  oauth2_proxy:
    image: quay.io/oauth2-proxy/oauth2-proxy:latest
    environment:
      - OAUTH2_PROXY_COOKIE_SECRET=UtazqvvUVHxIyNjb4mBt07FqnAwVvBI1VAZWAMqwIEQ=
      - OAUTH2_PROXY_CLIENT_SECRET=vcxOgK1t7bS4kXj9X33aqQ81Ba5jn7mv
    command:
        # 127.0.0.1 by default
      - --http-address=http://0.0.0.0:4180
      #- --reverse-proxy=true
      #- --cookie-domain=localhost
        #- --whitelist-domain=localhost
      - --upstream=https://httpbin.org/
        # todo skip provider button
      - --skip-provider-button=true
      - --set-xauthrequest=true
      - --whitelist-domain=.localhost
        #
        # oidc config
        #
      - --provider=oidc
        #- --scope="openid email offline_access"
      - --client-id=d1u01xae7h35nj256t8sr
      - --oidc-issuer-url=https://eiozf5.logto.app/oidc
      - --redirect-url=http://localhost:8080/oauth2/callback
        #useful in case i want downstream app to be able to see wazzzzzup
        #- --pass-access-token=true
      - --email-domain=*
        # todo set to false?
      - --insecure-oidc-allow-unverified-email=true
      # complains when provider has this enabled but we don't use it
      - --code-challenge-method=S256
    ports:
      - 8080:4180
